<!-- Copyright Â© 2018 Andrey Mogilev. All rights reserved. -->

<html>
<head>
    <!--TODO: use 'min' or 'slim' versions!-->

    <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>-->
    <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>


    <style type="text/css">
        #mynetwork {
            width: 100%;
            height: 80%;
            border: 1px solid lightgray;
        }
    </style>

    <title>SpringMX: Contexts Hierarchy</title>
</head>
<body>
<h1>Contexts Hierarchy</h1>
<div id="mynetwork"></div>

<script type="text/javascript">
	// create a network
	var container = document.getElementById('mynetwork');

	var options = {
		layout : {
			hierarchical : {
				enabled : true,
				direction : 'LR',
                levelSeparation : 300
			}
        },
		groups : {
			app : { color:{background:'#ffffcc'}, level:0, title:"Web Application"},
			rootCtx : { color:{background:'#ffffcc'}, level:1, shape:'box'},
			childCtx : { color:{background:' #ffff80'}, level:2, shape:'box'},
			bean : { color:{background:'#f2f2f2'}, level:3, shape:'box', title:"Bean", },
            beanCluster : { color:{background:'#f2f2f2'}, level:3, shape:'box', title:"Beans Cluster", borderWidth:4, shadow:true},
        },
        edges : {
			arrows : {
				to : {
					enabled : true,
                    scaleFactor : 0.5
                }
			}
        },
        nodes : {
			font : {
				multi : 'html'
            }
        },
        physics : { enabled : false}
    };

    var networkData = {
        nodes : new vis.DataSet(),
        edges : new vis.DataSet(),
        update : function (data) {
            this.nodes.clear();
            this.nodes.add(data.nodes);
            this.edges.clear();
            this.edges.add(data.edges);
        }
    };
	var network = new vis.Network(container, networkData, options);

	network.on('doubleClick', function(params) {
        if (params.nodes.length === 1) {
            var nodeId = params.nodes[0];
            if (network.isCluster(nodeId)) {
                network.openCluster(nodeId);
            } else {
                var n = networkData.nodes.get(nodeId);
                if (n.group === 'rootCtx' || n.group === 'childCtx') {
                    clusterContextBeans(n);
                }
            }
        }
    });

    function clusterContextBeans(contextNode) {
        network.cluster({
            joinCondition: function (node) {
                return node.group === 'bean' && node.parentId === contextNode.id;
            },
            clusterNodeProperties: {
                group: 'beanCluster'
            },
            processProperties: function (clusterOptions, childNodes) {
                clusterOptions.label = childNodes.length + " beans...";
                return clusterOptions;
            }
        });
    }

    function loadAndDraw() {
		$.get("/smxs/visdata", {test1 : 'foo'}, function(data) {
		    networkData.update(data);

            data.nodes.forEach(function (n) {
                if (n.group === 'rootCtx' || n.group === 'childCtx') {
                    clusterContextBeans(n);
                }
            });
        });
		// var nodes = [
		// 	{id: 1, group: 'app', label: 'ROOT'},
		// 	{id: 2, group : 'rootCtx', label: 'Root \nWebApplicationContext'},
		// 	{id: 3, group : 'childCtx', label: 'WebApplicationContext\n<b>locations:</b> location1;location2'},
		// 	{id: 4, group : 'bean', label: 'SampleBean1'},
		// 	{id: 5, group : 'bean', label: 'SampleBean2'},
		// 	{id: 6, group : 'bean', label: 'SampleBean3'},
		// ];
        //
		// // create an array with edges
		// var edges = [
		// 	{from: 1, to: 2},
		// 	{from: 2, to: 3},
		// 	{from: 2, to: 4},
		// 	{from: 3, to: 5},
		// 	{from: 3, to: 6}
		// ];
        //
		// // provide the data in the vis format
		// var data = {
		// 	nodes: nodes,
		// 	edges: edges
		// };
        //
		// network.setData(data);
    }

    loadAndDraw();

</script>
</body>
</html>